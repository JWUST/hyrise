// Copyright (c) 2012 Hasso-Plattner-Institut fuer Softwaresystemtechnik GmbH. All rights reserved.
#ifndef SRC_LIB_ACCESS_STRINGEQUALSPECIALEXPRESSION_H_
#define SRC_LIB_ACCESS_STRINGEQUALSPECIALEXPRESSION_H_

#include "json.h"

#include "access/expressions/AbstractExpression.h"
#include "helper/types.h"
#include "storage/FixedLengthVector.h"
#include "storage/OrderPreservingDictionary.h"
#include "storage/storage_types.h"

namespace hyrise { namespace access {

class StringEqualSpecialExpression : public AbstractExpression {
  storage::c_atable_ptr_t _table;
  std::shared_ptr<FixedLengthVector<value_id_t>> _vector;
  std::shared_ptr<OrderPreservingDictionary<hyrise_string_t>> _dict;
  const size_t _column;
  const hyrise_string_t _value;
  value_id_t _valueid;
 public:
  StringEqualSpecialExpression(const size_t& column, const hyrise_string_t& value);
  bool operator()(const size_t& row);
  virtual pos_list_t* match(const size_t start, const size_t stop);
  virtual void walk(const std::vector<hyrise::storage::c_atable_ptr_t> &l);
  static std::unique_ptr<StringEqualSpecialExpression> parse(const Json::Value& data);
  virtual StringEqualSpecialExpression * clone();
  virtual uint determineDynamicCount(size_t max_task_size, size_t input_table_size);
 protected:
  int table_size_size = 7;
  int lookup_size = 121;

  int table_size[7] = {100000000, 50000000, 10000000, 5000000, 1000000, 500000, 100000};

int lookup[7][121][2] = {{{427, 2}, {1249, 1}, {320, 3}, {260, 4}, {114, 11}, {100, 13}, {216, 5}, {107, 12}, {187, 6}, {164, 7}, {148, 8}, {135, 9}, {124, 10}, {94, 14}, {78, 18}, {81, 17}, {74, 19}, {89, 15}, {70, 21}, {85, 16}, {73, 20}, {65, 23}, {67, 22}, {63, 24}, {54, 31}, {60, 26}, {61, 25}, {58, 27}, {57, 28}, {56, 29}, {53, 32}, {51, 33}, {49, 34}, {48, 35}, {40, 41}, {46, 36}, {38, 44}, {37, 45}, {44, 38}, {43, 39}, {42, 40}, {35, 48}, {39, 43}, {34, 49}, {36, 46}, {40, 42}, {55, 30}, {45, 37}, {33, 51}, {32, 52}, {35, 47}, {34, 50}, {28, 61}, {31, 54}, {30, 56}, {31, 55}, {29, 58}, {30, 57}, {29, 59}, {27, 64}, {27, 63}, {28, 60}, {32, 53}, {27, 65}, {28, 62}, {23, 73}, {21, 81}, {19, 89}, {18, 97}, {15, 113}, {16, 105}, {14, 121}, {13, 137}, {11, 153}, {11, 161}, {13, 129}, {10, 169}, {12, 145}, {10, 177}, {9, 185}, {9, 201}, {8, 209}, {8, 225}, {7, 241}, {7, 233}, {8, 217}, {7, 249}, {7, 256}, {9, 193}, {6, 272}, {6, 304}, {6, 320}, {6, 288}, {5, 352}, {5, 336}, {5, 368}, {5, 384}, {4, 432}, {4, 448}, {4, 416}, {4, 400}, {4, 496}, {4, 480}, {3, 544}, {3, 576}, {4, 512}, {4, 464}, {3, 608}, {3, 672}, {3, 640}, {2, 832}, {2, 864}, {2, 768}, {2, 800}, {2, 736}, {3, 704}, {2, 992}, {2, 1024}, {2, 928}, {2, 960}, {2, 896}},
{{213, 2}, {630, 1}, {131, 4}, {158, 3}, {109, 5}, {95, 6}, {52, 13}, {83, 7}, {75, 8}, {44, 16}, {47, 15}, {68, 9}, {63, 10}, {59, 11}, {55, 12}, {48, 14}, {38, 20}, {36, 22}, {43, 17}, {41, 18}, {39, 19}, {37, 21}, {32, 28}, {35, 23}, {35, 24}, {34, 25}, {28, 33}, {33, 26}, {33, 27}, {31, 30}, {31, 29}, {24, 38}, {30, 31}, {26, 35}, {30, 32}, {27, 34}, {25, 37}, {23, 39}, {20, 47}, {23, 40}, {22, 41}, {25, 36}, {22, 42}, {21, 43}, {21, 44}, {20, 45}, {20, 46}, {19, 49}, {19, 48}, {18, 51}, {18, 53}, {17, 54}, {17, 56}, {15, 64}, {16, 58}, {16, 60}, {17, 57}, {16, 59}, {16, 61}, {15, 62}, {15, 63}, {15, 65}, {18, 52}, {19, 50}, {17, 55}, {13, 73}, {11, 81}, {10, 89}, {10, 97}, {9, 105}, {8, 113}, {8, 121}, {7, 137}, {6, 145}, {6, 153}, {7, 129}, {6, 161}, {6, 169}, {5, 193}, {5, 185}, {4, 209}, {5, 201}, {4, 217}, {4, 225}, {4, 233}, {4, 241}, {4, 249}, {5, 177}, {3, 272}, {3, 288}, {4, 256}, {3, 304}, {3, 336}, {3, 320}, {2, 384}, {3, 368}, {2, 400}, {2, 416}, {3, 352}, {2, 432}, {2, 448}, {2, 464}, {2, 480}, {2, 496}, {2, 512}, {2, 544}, {2, 608}, {2, 576}, {1, 640}, {1, 672}, {1, 704}, {1, 736}, {1, 768}, {1, 800}, {1, 832}, {1, 864}, {1, 896}, {1, 928}, {1, 960}, {1, 992}, {1, 1024}},
{{123, 1}, {43, 2}, {34, 3}, {14, 10}, {20, 6}, {12, 11}, {27, 4}, {23, 5}, {17, 8}, {18, 7}, {13, 12}, {15, 9}, {9, 18}, {11, 14}, {10, 16}, {8, 20}, {8, 19}, {9, 17}, {9, 21}, {7, 22}, {10, 15}, {7, 28}, {7, 23}, {12, 13}, {7, 26}, {5, 38}, {5, 34}, {5, 36}, {5, 37}, {6, 41}, {6, 35}, {6, 29}, {4, 42}, {4, 44}, {5, 43}, {4, 46}, {7, 24}, {5, 45}, {4, 47}, {4, 50}, {7, 25}, {4, 53}, {6, 30}, {7, 27}, {5, 40}, {3, 63}, {6, 31}, {3, 62}, {3, 59}, {5, 32}, {3, 64}, {5, 33}, {2, 89}, {5, 39}, {2, 97}, {4, 49}, {4, 52}, {4, 48}, {4, 51}, {3, 55}, {2, 105}, {4, 54}, {3, 60}, {4, 57}, {2, 113}, {2, 121}, {4, 56}, {4, 58}, {3, 65}, {3, 61}, {1, 129}, {2, 73}, {1, 145}, {2, 81}, {1, 169}, {1, 153}, {1, 137}, {1, 161}, {1, 177}, {1, 193}, {1, 201}, {1, 185}, {1, 249}, {1, 384}, {1, 209}, {1, 217}, {1, 233}, {1, 304}, {1, 241}, {1, 256}, {1, 225}, {0, 512}, {1, 272}, {1, 288}, {1, 448}, {1, 320}, {1, 544}, {1, 608}, {1, 336}, {1, 464}, {1, 352}, {1, 704}, {1, 672}, {1, 368}, {1, 432}, {1, 736}, {1, 400}, {1, 576}, {1, 416}, {1, 768}, {1, 864}, {1, 800}, {0, 480}, {1, 832}, {0, 496}, {1, 896}, {1, 960}, {1, 640}, {1, 928}, {1, 1024}, {1, 992}},
{{60, 1}, {22, 2}, {17, 3}, {10, 6}, {14, 4}, {11, 5}, {9, 7}, {6, 12}, {6, 10}, {5, 16}, {4, 15}, {8, 8}, {8, 9}, {3, 25}, {5, 13}, {4, 19}, {6, 11}, {4, 17}, {5, 14}, {4, 18}, {3, 22}, {4, 21}, {2, 48}, {3, 23}, {4, 20}, {3, 26}, {3, 24}, {3, 27}, {2, 53}, {3, 28}, {3, 29}, {3, 31}, {3, 30}, {2, 35}, {2, 33}, {2, 32}, {2, 36}, {2, 34}, {2, 37}, {2, 38}, {2, 39}, {2, 40}, {2, 41}, {2, 42}, {2, 45}, {2, 43}, {2, 46}, {2, 50}, {2, 47}, {2, 51}, {2, 49}, {2, 52}, {2, 44}, {1, 56}, {2, 54}, {2, 55}, {1, 58}, {2, 57}, {1, 59}, {1, 61}, {1, 62}, {1, 65}, {1, 64}, {1, 63}, {1, 60}, {1, 73}, {1, 81}, {1, 89}, {1, 97}, {1, 105}, {1, 113}, {1, 121}, {1, 129}, {1, 137}, {1, 145}, {1, 153}, {1, 161}, {1, 169}, {1, 177}, {1, 185}, {1, 193}, {1, 201}, {1, 209}, {0, 217}, {0, 225}, {0, 233}, {0, 256}, {0, 249}, {1, 272}, {0, 241}, {1, 496}, {0, 288}, {1, 384}, {1, 512}, {1, 448}, {0, 304}, {1, 320}, {1, 336}, {1, 544}, {0, 400}, {1, 352}, {1, 704}, {1, 672}, {1, 368}, {1, 736}, {1, 768}, {1, 800}, {0, 416}, {1, 832}, {0, 432}, {0, 640}, {1, 480}, {0, 464}, {1, 992}, {1, 928}, {1, 864}, {1, 896}, {1, 608}, {0, 576}, {1, 1024}, {1, 960}},
{{11, 1}, {4, 2}, {3, 3}, {1, 7}, {2, 5}, {2, 4}, {1, 6}, {1, 8}, {1, 9}, {1, 13}, {1, 10}, {1, 15}, {1, 11}, {1, 12}, {1, 14}, {1, 16}, {1, 18}, {1, 17}, {1, 19}, {1, 21}, {1, 22}, {1, 24}, {1, 20}, {1, 23}, {0, 25}, {0, 28}, {0, 27}, {0, 26}, {0, 29}, {0, 33}, {0, 30}, {0, 32}, {0, 34}, {0, 31}, {0, 35}, {0, 36}, {0, 37}, {0, 39}, {0, 42}, {0, 38}, {0, 40}, {0, 41}, {0, 43}, {0, 44}, {0, 47}, {0, 45}, {0, 51}, {0, 46}, {0, 48}, {0, 50}, {0, 53}, {0, 49}, {0, 54}, {0, 55}, {0, 52}, {0, 58}, {0, 56}, {0, 62}, {0, 60}, {0, 61}, {0, 57}, {0, 64}, {0, 65}, {0, 59}, {0, 63}, {0, 73}, {0, 81}, {0, 89}, {0, 97}, {0, 113}, {0, 105}, {0, 121}, {0, 129}, {0, 137}, {0, 145}, {0, 153}, {0, 169}, {0, 161}, {0, 177}, {0, 185}, {0, 193}, {0, 201}, {0, 209}, {0, 217}, {0, 225}, {0, 233}, {0, 241}, {0, 249}, {0, 256}, {0, 272}, {0, 288}, {0, 304}, {0, 336}, {0, 320}, {0, 352}, {1, 768}, {0, 368}, {0, 384}, {1, 704}, {1, 736}, {0, 400}, {1, 512}, {0, 464}, {0, 416}, {1, 640}, {1, 496}, {1, 800}, {0, 432}, {0, 448}, {0, 480}, {1, 928}, {1, 896}, {0, 544}, {0, 608}, {1, 960}, {1, 1024}, {1, 832}, {0, 576}, {0, 672}, {1, 864}, {1, 992}},
{{5, 1}, {1, 3}, {2, 2}, {1, 4}, {1, 6}, {1, 5}, {1, 7}, {0, 11}, {1, 8}, {1, 9}, {0, 10}, {0, 12}, {0, 13}, {0, 14}, {0, 15}, {0, 18}, {0, 16}, {0, 17}, {0, 21}, {0, 19}, {0, 24}, {0, 22}, {0, 20}, {0, 23}, {0, 25}, {0, 26}, {0, 28}, {0, 27}, {0, 29}, {0, 30}, {0, 31}, {0, 35}, {0, 32}, {0, 33}, {0, 36}, {0, 34}, {0, 39}, {0, 37}, {0, 38}, {0, 40}, {0, 42}, {0, 45}, {0, 43}, {0, 41}, {0, 44}, {0, 46}, {0, 49}, {0, 47}, {0, 52}, {0, 50}, {0, 51}, {0, 59}, {0, 53}, {0, 48}, {0, 55}, {0, 54}, {0, 60}, {0, 56}, {0, 61}, {0, 57}, {0, 62}, {0, 58}, {0, 64}, {0, 65}, {0, 63}, {0, 73}, {0, 81}, {0, 89}, {0, 97}, {0, 121}, {0, 137}, {0, 129}, {0, 105}, {0, 145}, {0, 153}, {0, 113}, {0, 161}, {0, 169}, {0, 177}, {0, 193}, {0, 185}, {0, 201}, {0, 209}, {0, 217}, {0, 241}, {0, 225}, {0, 233}, {0, 256}, {0, 249}, {0, 272}, {0, 288}, {0, 304}, {0, 320}, {0, 336}, {0, 352}, {0, 544}, {1, 640}, {0, 368}, {0, 384}, {0, 416}, {0, 400}, {0, 432}, {1, 800}, {1, 768}, {0, 448}, {0, 464}, {0, 496}, {1, 864}, {1, 704}, {0, 480}, {1, 832}, {1, 992}, {1, 960}, {0, 512}, {1, 1024}, {1, 672}, {1, 896}, {0, 576}, {0, 736}, {1, 928}, {0, 608}},
{{1, 1}, {1, 2}, {0, 5}, {0, 3}, {0, 4}, {0, 6}, {0, 7}, {0, 9}, {0, 8}, {0, 11}, {0, 10}, {0, 14}, {0, 12}, {0, 13}, {0, 15}, {0, 16}, {0, 18}, {0, 17}, {0, 19}, {0, 20}, {0, 21}, {0, 23}, {0, 22}, {0, 24}, {0, 25}, {0, 26}, {0, 29}, {0, 28}, {0, 27}, {0, 31}, {0, 32}, {0, 30}, {0, 34}, {0, 35}, {0, 36}, {0, 33}, {0, 40}, {0, 38}, {0, 37}, {0, 42}, {0, 39}, {0, 41}, {0, 43}, {0, 48}, {0, 45}, {0, 44}, {0, 47}, {0, 49}, {0, 50}, {0, 51}, {0, 46}, {0, 53}, {0, 52}, {0, 54}, {0, 56}, {0, 55}, {0, 57}, {0, 63}, {0, 60}, {0, 64}, {0, 59}, {0, 61}, {0, 62}, {0, 65}, {0, 58}, {0, 73}, {0, 81}, {0, 89}, {0, 97}, {0, 113}, {0, 105}, {0, 129}, {0, 121}, {0, 137}, {0, 145}, {0, 153}, {0, 169}, {0, 161}, {0, 193}, {0, 177}, {0, 185}, {0, 217}, {0, 201}, {0, 209}, {0, 225}, {0, 233}, {0, 241}, {0, 249}, {0, 256}, {0, 272}, {0, 304}, {0, 288}, {0, 320}, {1, 336}, {0, 368}, {0, 352}, {1, 736}, {0, 400}, {0, 384}, {0, 416}, {0, 672}, {1, 512}, {0, 448}, {0, 432}, {1, 464}, {0, 480}, {1, 800}, {1, 832}, {1, 928}, {0, 496}, {0, 640}, {0, 576}, {1, 896}, {0, 544}, {1, 960}, {1, 992}, {0, 608}, {1, 864}, {1, 1024}, {1, 768}, {0, 704}}};
  
};

}}

#endif

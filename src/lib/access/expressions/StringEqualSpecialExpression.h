// Copyright (c) 2012 Hasso-Plattner-Institut fuer Softwaresystemtechnik GmbH. All rights reserved.
#ifndef SRC_LIB_ACCESS_STRINGEQUALSPECIALEXPRESSION_H_
#define SRC_LIB_ACCESS_STRINGEQUALSPECIALEXPRESSION_H_

#include "json.h"

#include "access/expressions/AbstractExpression.h"
#include "helper/types.h"
#include "storage/FixedLengthVector.h"
#include "storage/OrderPreservingDictionary.h"
#include "storage/storage_types.h"

namespace hyrise { namespace access {

class StringEqualSpecialExpression : public AbstractExpression {
  storage::c_atable_ptr_t _table;
  std::shared_ptr<FixedLengthVector<value_id_t>> _vector;
  std::shared_ptr<OrderPreservingDictionary<hyrise_string_t>> _dict;
  const size_t _column;
  const hyrise_string_t _value;
  value_id_t _valueid;
 public:
  StringEqualSpecialExpression(const size_t& column, const hyrise_string_t& value);
  bool operator()(const size_t& row);
  virtual pos_list_t* match(const size_t start, const size_t stop);
  virtual void walk(const std::vector<hyrise::storage::c_atable_ptr_t> &l);
  static std::unique_ptr<StringEqualSpecialExpression> parse(const Json::Value& data);
  virtual StringEqualSpecialExpression * clone();
  virtual uint determineDynamicCount(size_t max_task_size, size_t input_table_size);
 protected:
  
  int table_size_size = 7;
  int lookup_size = 121;

  int table_size[7] = {100000000, 50000000, 10000000, 5000000, 1000000, 500000, 100000};

int lookup[7][121][2] = {{{53, 32}, {28, 61}, {54, 31}, {55, 30}, {56, 29}, {27, 63}, {27, 64}, {28, 60}, {29, 59}, {29, 58}, {28, 62}, {19, 89}, {57, 28}, {30, 56}, {30, 57}, {58, 27}, {31, 55}, {31, 54}, {15, 113}, {60, 26}, {32, 53}, {21, 81}, {18, 97}, {61, 25}, {14, 121}, {9, 185}, {32, 52}, {11, 153}, {12, 145}, {13, 129}, {23, 73}, {33, 51}, {63, 24}, {8, 225}, {34, 50}, {10, 169}, {34, 49}, {11, 161}, {35, 48}, {10, 177}, {7, 249}, {8, 217}, {8, 209}, {35, 47}, {7, 256}, {9, 193}, {16, 105}, {13, 137}, {65, 23}, {36, 46}, {7, 241}, {9, 201}, {6, 288}, {7, 233}, {27, 65}, {38, 44}, {6, 272}, {37, 45}, {6, 304}, {67, 22}, {39, 43}, {5, 336}, {6, 320}, {40, 41}, {40, 42}, {70, 21}, {5, 352}, {5, 384}, {5, 368}, {42, 40}, {4, 448}, {4, 432}, {43, 39}, {44, 38}, {73, 20}, {45, 37}, {4, 496}, {4, 400}, {4, 480}, {4, 464}, {74, 19}, {4, 416}, {3, 544}, {46, 36}, {3, 576}, {4, 512}, {49, 34}, {78, 18}, {48, 35}, {51, 33}, {81, 17}, {3, 608}, {3, 640}, {3, 672}, {85, 16}, {3, 704}, {89, 15}, {2, 768}, {2, 832}, {2, 736}, {2, 800}, {2, 896}, {94, 14}, {2, 864}, {2, 928}, {2, 992}, {2, 960}, {2, 1024}, {100, 13}, {107, 12}, {114, 11}, {124, 10}, {135, 9}, {148, 8}, {164, 7}, {187, 6}, {216, 5}, {260, 4}, {320, 3}, {427, 2}, {1249, 1}},
{{31, 30}, {30, 32}, {30, 31}, {31, 29}, {33, 27}, {15, 63}, {15, 64}, {15, 62}, {32, 28}, {34, 25}, {33, 26}, {16, 59}, {17, 57}, {16, 61}, {35, 24}, {17, 55}, {18, 53}, {17, 56}, {36, 22}, {11, 81}, {17, 54}, {16, 58}, {10, 89}, {35, 23}, {16, 60}, {18, 52}, {37, 21}, {10, 97}, {19, 50}, {18, 51}, {6, 161}, {13, 73}, {15, 65}, {6, 145}, {38, 20}, {20, 47}, {7, 129}, {8, 121}, {19, 48}, {20, 45}, {9, 105}, {21, 44}, {8, 113}, {5, 193}, {19, 49}, {41, 18}, {20, 46}, {7, 137}, {22, 41}, {39, 19}, {22, 42}, {5, 185}, {21, 43}, {4, 249}, {4, 233}, {23, 40}, {5, 201}, {4, 209}, {5, 177}, {6, 169}, {25, 36}, {6, 153}, {4, 256}, {23, 39}, {4, 241}, {24, 38}, {4, 217}, {43, 17}, {25, 37}, {3, 272}, {26, 35}, {4, 225}, {44, 16}, {27, 34}, {3, 288}, {28, 33}, {47, 15}, {3, 320}, {3, 304}, {3, 336}, {3, 368}, {3, 352}, {48, 14}, {2, 384}, {2, 400}, {52, 13}, {2, 416}, {2, 448}, {2, 432}, {2, 464}, {2, 480}, {2, 496}, {2, 512}, {55, 12}, {2, 608}, {2, 576}, {59, 11}, {1, 640}, {2, 544}, {1, 704}, {63, 10}, {1, 672}, {1, 768}, {1, 736}, {1, 832}, {1, 864}, {1, 800}, {68, 9}, {1, 896}, {1, 928}, {1, 960}, {1, 1024}, {1, 992}, {75, 8}, {83, 7}, {95, 6}, {109, 5}, {131, 4}, {158, 3}, {213, 2}, {630, 1}},
{{5, 32}, {6, 29}, {7, 24}, {6, 30}, {7, 28}, {7, 26}, {7, 22}, {7, 27}, {6, 31}, {7, 25}, {5, 39}, {5, 37}, {8, 19}, {9, 21}, {5, 34}, {7, 23}, {4, 44}, {5, 38}, {4, 42}, {8, 20}, {5, 45}, {9, 17}, {5, 40}, {4, 50}, {5, 33}, {4, 47}, {4, 46}, {5, 43}, {4, 48}, {9, 18}, {4, 51}, {3, 62}, {5, 36}, {6, 35}, {4, 49}, {10, 16}, {3, 60}, {4, 54}, {4, 58}, {3, 63}, {10, 15}, {3, 55}, {3, 61}, {3, 59}, {6, 41}, {3, 65}, {2, 81}, {4, 57}, {11, 14}, {3, 64}, {4, 56}, {4, 53}, {4, 52}, {2, 97}, {2, 73}, {13, 12}, {12, 11}, {2, 105}, {2, 89}, {12, 13}, {2, 113}, {14, 10}, {15, 9}, {2, 121}, {1, 129}, {1, 137}, {1, 161}, {1, 145}, {1, 169}, {17, 8}, {1, 153}, {18, 7}, {1, 193}, {1, 185}, {1, 201}, {1, 177}, {1, 209}, {20, 6}, {1, 217}, {1, 256}, {23, 5}, {1, 225}, {1, 352}, {1, 241}, {1, 233}, {1, 304}, {27, 4}, {1, 249}, {1, 336}, {1, 384}, {1, 320}, {1, 272}, {1, 288}, {1, 432}, {0, 480}, {1, 368}, {1, 464}, {34, 3}, {1, 544}, {0, 512}, {1, 448}, {1, 400}, {1, 416}, {1, 576}, {1, 608}, {0, 496}, {1, 672}, {1, 704}, {43, 2}, {1, 800}, {1, 640}, {1, 736}, {1, 768}, {1, 832}, {1, 864}, {1, 928}, {1, 960}, {1, 1024}, {1, 992}, {1, 896}, {123, 1}},
{{3, 26}, {3, 25}, {4, 19}, {3, 27}, {4, 18}, {3, 23}, {3, 24}, {4, 20}, {4, 21}, {3, 30}, {4, 15}, {3, 22}, {3, 28}, {3, 29}, {2, 33}, {2, 37}, {2, 36}, {2, 35}, {4, 17}, {5, 16}, {5, 14}, {1, 58}, {2, 32}, {2, 34}, {2, 42}, {2, 39}, {5, 13}, {2, 40}, {2, 38}, {3, 31}, {2, 41}, {6, 12}, {2, 48}, {2, 47}, {2, 44}, {2, 52}, {6, 11}, {2, 49}, {6, 10}, {2, 50}, {2, 54}, {2, 51}, {2, 46}, {2, 45}, {2, 43}, {2, 55}, {2, 53}, {1, 56}, {2, 57}, {1, 62}, {1, 61}, {1, 64}, {1, 59}, {8, 9}, {1, 60}, {1, 73}, {1, 63}, {1, 81}, {8, 8}, {1, 65}, {9, 7}, {1, 89}, {10, 6}, {1, 97}, {11, 5}, {1, 113}, {1, 121}, {14, 4}, {1, 137}, {1, 105}, {1, 129}, {1, 153}, {0, 225}, {1, 209}, {17, 3}, {1, 161}, {1, 145}, {1, 185}, {1, 169}, {1, 193}, {0, 217}, {1, 177}, {0, 256}, {1, 272}, {1, 336}, {22, 2}, {0, 249}, {0, 241}, {1, 201}, {1, 320}, {0, 288}, {1, 352}, {0, 304}, {1, 368}, {1, 384}, {0, 233}, {1, 448}, {1, 496}, {1, 512}, {1, 480}, {0, 400}, {0, 432}, {0, 464}, {0, 416}, {1, 544}, {60, 1}, {1, 672}, {1, 768}, {1, 704}, {0, 576}, {1, 736}, {0, 640}, {1, 608}, {1, 832}, {1, 800}, {1, 864}, {1, 896}, {1, 960}, {1, 928}, {1, 1024}, {1, 992}},
{{1, 7}, {1, 9}, {1, 13}, {1, 6}, {1, 12}, {1, 10}, {2, 5}, {1, 15}, {1, 8}, {1, 11}, {1, 14}, {2, 4}, {1, 17}, {1, 16}, {1, 18}, {1, 22}, {1, 24}, {1, 19}, {1, 23}, {3, 3}, {1, 20}, {1, 21}, {0, 26}, {0, 25}, {4, 2}, {0, 29}, {0, 27}, {0, 28}, {0, 30}, {0, 32}, {0, 31}, {0, 35}, {0, 33}, {0, 40}, {0, 36}, {0, 34}, {0, 37}, {0, 38}, {0, 42}, {0, 41}, {0, 39}, {0, 49}, {0, 46}, {0, 43}, {0, 44}, {0, 51}, {0, 50}, {0, 52}, {0, 45}, {0, 48}, {0, 56}, {0, 57}, {0, 47}, {0, 53}, {0, 54}, {11, 1}, {0, 55}, {0, 59}, {0, 65}, {0, 60}, {0, 58}, {0, 61}, {0, 64}, {0, 62}, {0, 73}, {0, 63}, {0, 81}, {0, 89}, {0, 161}, {0, 105}, {0, 113}, {0, 145}, {0, 129}, {0, 97}, {0, 121}, {0, 153}, {0, 137}, {0, 185}, {0, 241}, {0, 177}, {0, 201}, {0, 225}, {0, 193}, {0, 169}, {0, 288}, {0, 209}, {0, 217}, {0, 304}, {0, 233}, {0, 400}, {0, 249}, {0, 368}, {0, 464}, {0, 336}, {0, 256}, {0, 272}, {0, 384}, {0, 352}, {0, 432}, {1, 496}, {0, 576}, {1, 512}, {0, 416}, {0, 320}, {0, 448}, {0, 480}, {1, 640}, {0, 544}, {0, 608}, {1, 704}, {1, 736}, {1, 768}, {0, 672}, {1, 800}, {1, 896}, {1, 992}, {1, 1024}, {1, 864}, {1, 832}, {1, 960}, {1, 928}},
{{1, 6}, {1, 7}, {1, 4}, {0, 10}, {0, 12}, {1, 5}, {1, 8}, {1, 3}, {1, 9}, {0, 13}, {0, 11}, {0, 16}, {2, 2}, {0, 14}, {0, 15}, {0, 17}, {0, 18}, {0, 19}, {0, 21}, {0, 20}, {0, 23}, {0, 22}, {0, 24}, {5, 1}, {0, 28}, {0, 27}, {0, 25}, {0, 26}, {0, 29}, {0, 30}, {0, 36}, {0, 33}, {0, 31}, {0, 32}, {0, 34}, {0, 38}, {0, 46}, {0, 42}, {0, 35}, {0, 37}, {0, 41}, {0, 40}, {0, 43}, {0, 39}, {0, 45}, {0, 44}, {0, 50}, {0, 47}, {0, 49}, {0, 54}, {0, 48}, {0, 56}, {0, 55}, {0, 59}, {0, 58}, {0, 51}, {0, 61}, {0, 53}, {0, 52}, {0, 81}, {0, 57}, {0, 60}, {0, 64}, {0, 62}, {0, 63}, {0, 65}, {0, 73}, {0, 105}, {0, 97}, {0, 89}, {0, 113}, {0, 129}, {0, 121}, {0, 153}, {0, 193}, {0, 145}, {0, 169}, {0, 137}, {0, 177}, {0, 161}, {0, 241}, {0, 217}, {0, 233}, {0, 249}, {0, 185}, {0, 209}, {0, 201}, {0, 225}, {0, 336}, {0, 272}, {0, 256}, {0, 304}, {0, 368}, {0, 448}, {0, 288}, {0, 384}, {0, 320}, {0, 544}, {0, 352}, {0, 432}, {1, 640}, {0, 496}, {0, 512}, {0, 464}, {0, 400}, {0, 416}, {0, 608}, {1, 672}, {1, 704}, {1, 800}, {1, 768}, {0, 736}, {0, 576}, {1, 928}, {0, 480}, {1, 832}, {1, 896}, {1, 864}, {1, 992}, {1, 1024}, {1, 960}},
{{0, 4}, {0, 5}, {1, 1}, {0, 3}, {1, 2}, {0, 9}, {0, 7}, {0, 6}, {0, 8}, {0, 10}, {0, 11}, {0, 12}, {0, 14}, {0, 13}, {0, 15}, {0, 16}, {0, 17}, {0, 18}, {0, 19}, {0, 22}, {0, 20}, {0, 21}, {0, 24}, {0, 25}, {0, 28}, {0, 29}, {0, 27}, {0, 23}, {0, 26}, {0, 32}, {0, 31}, {0, 30}, {0, 35}, {0, 34}, {0, 33}, {0, 37}, {0, 38}, {0, 41}, {0, 39}, {0, 40}, {0, 42}, {0, 36}, {0, 44}, {0, 43}, {0, 45}, {0, 48}, {0, 47}, {0, 46}, {0, 54}, {0, 49}, {0, 50}, {0, 51}, {0, 63}, {0, 52}, {0, 53}, {0, 57}, {0, 59}, {0, 55}, {0, 56}, {0, 58}, {0, 61}, {0, 60}, {0, 62}, {0, 64}, {0, 65}, {0, 81}, {0, 73}, {0, 89}, {0, 97}, {0, 129}, {0, 113}, {0, 105}, {0, 137}, {0, 121}, {0, 185}, {0, 161}, {0, 177}, {0, 145}, {0, 153}, {0, 201}, {0, 209}, {0, 193}, {0, 217}, {0, 241}, {0, 225}, {0, 169}, {0, 233}, {0, 272}, {0, 352}, {0, 256}, {1, 336}, {0, 288}, {0, 400}, {0, 368}, {0, 384}, {0, 249}, {0, 448}, {0, 480}, {0, 416}, {0, 432}, {1, 512}, {0, 320}, {0, 304}, {1, 464}, {0, 496}, {0, 608}, {0, 672}, {0, 576}, {0, 544}, {0, 640}, {1, 736}, {1, 800}, {1, 768}, {1, 896}, {0, 704}, {1, 832}, {1, 928}, {1, 960}, {1, 864}, {1, 1024}, {1, 992}}};
  
};

}}

#endif

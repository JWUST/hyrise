// Copyright (c) 2012 Hasso-Plattner-Institut fuer Softwaresystemtechnik GmbH. All rights reserved.
#ifndef SRC_LIB_ACCESS_STRINGEQUALSPECIALEXPRESSION_H_
#define SRC_LIB_ACCESS_STRINGEQUALSPECIALEXPRESSION_H_

#include "json.h"

#include "access/expressions/AbstractExpression.h"
#include "helper/types.h"
#include "storage/FixedLengthVector.h"
#include "storage/OrderPreservingDictionary.h"
#include "storage/storage_types.h"

namespace hyrise { namespace access {

class StringEqualSpecialExpression : public AbstractExpression {
  storage::c_atable_ptr_t _table;
  std::shared_ptr<FixedLengthVector<value_id_t>> _vector;
  std::shared_ptr<OrderPreservingDictionary<hyrise_string_t>> _dict;
  const size_t _column;
  const hyrise_string_t _value;
  value_id_t _valueid;
 public:
  StringEqualSpecialExpression(const size_t& column, const hyrise_string_t& value);
  bool operator()(const size_t& row);
  virtual pos_list_t* match(const size_t start, const size_t stop);
  virtual void walk(const std::vector<hyrise::storage::c_atable_ptr_t> &l);
  static std::unique_ptr<StringEqualSpecialExpression> parse(const Json::Value& data);
  virtual StringEqualSpecialExpression * clone();
  virtual uint determineDynamicCount(size_t max_task_size, size_t input_table_size);
 protected:
  
  int table_size_size = 7;
  int lookup_size = 121;

  int table_size[7] = {100000000, 50000000, 10000000, 5000000, 1000000, 500000, 100000};

int lookup[7][121][2] = {{{56, 32}, {33, 61}, {58, 31}, {61, 30}, {62, 29}, {33, 63}, {32, 64}, {34, 60}, {35, 59}, {35, 58}, {33, 62}, {25, 89}, {62, 28}, {35, 56}, {35, 57}, {62, 27}, {37, 55}, {37, 54}, {21, 113}, {65, 26}, {37, 53}, {27, 81}, {23, 97}, {67, 25}, {20, 121}, {13, 185}, {38, 52}, {16, 153}, {17, 145}, {19, 129}, {29, 73}, {38, 51}, {68, 24}, {12, 225}, {39, 50}, {15, 169}, {40, 49}, {15, 161}, {40, 48}, {14, 177}, {12, 249}, {13, 217}, {12, 209}, {41, 47}, {11, 256}, {14, 193}, {22, 105}, {19, 137}, {70, 23}, {43, 46}, {11, 241}, {13, 201}, {10, 288}, {12, 233}, {32, 65}, {45, 44}, {11, 272}, {43, 45}, {11, 304}, {73, 22}, {45, 43}, {10, 336}, {10, 320}, {47, 41}, {45, 42}, {75, 21}, {10, 352}, {9, 384}, {10, 368}, {46, 40}, {8, 448}, {8, 432}, {48, 39}, {48, 38}, {80, 20}, {51, 37}, {8, 496}, {9, 400}, {8, 480}, {8, 464}, {82, 19}, {8, 416}, {8, 544}, {52, 36}, {7, 576}, {8, 512}, {54, 34}, {84, 18}, {52, 35}, {55, 33}, {88, 17}, {7, 608}, {7, 640}, {7, 672}, {93, 16}, {7, 704}, {96, 15}, {6, 768}, {6, 832}, {7, 736}, {6, 800}, {6, 896}, {103, 14}, {6, 864}, {6, 928}, {6, 992}, {6, 960}, {6, 1024}, {112, 13}, {119, 12}, {128, 11}, {138, 10}, {152, 9}, {169, 8}, {190, 7}, {225, 6}, {260, 5}, {324, 4}, {424, 3}, {632, 2}, {1249, 1}},
{{35, 30}, {34, 32}, {34, 31}, {35, 29}, {36, 27}, {21, 63}, {20, 64}, {20, 62}, {35, 28}, {37, 25}, {36, 26}, {21, 59}, {21, 57}, {21, 61}, {38, 24}, {22, 55}, {23, 53}, {22, 56}, {40, 22}, {16, 81}, {23, 54}, {22, 58}, {14, 89}, {40, 23}, {21, 60}, {23, 52}, {41, 21}, {14, 97}, {24, 50}, {23, 51}, {10, 161}, {18, 73}, {20, 65}, {11, 145}, {42, 20}, {24, 47}, {12, 129}, {12, 121}, {24, 48}, {25, 45}, {13, 105}, {25, 44}, {14, 113}, {9, 193}, {24, 49}, {45, 18}, {25, 46}, {11, 137}, {27, 41}, {45, 19}, {27, 42}, {8, 185}, {26, 43}, {8, 249}, {8, 233}, {26, 40}, {9, 201}, {8, 209}, {9, 177}, {10, 169}, {29, 36}, {11, 153}, {7, 256}, {28, 39}, {8, 241}, {27, 38}, {8, 217}, {48, 17}, {28, 37}, {7, 272}, {29, 35}, {8, 225}, {49, 16}, {30, 34}, {7, 288}, {31, 33}, {53, 15}, {7, 320}, {7, 304}, {7, 336}, {7, 368}, {6, 352}, {55, 14}, {6, 384}, {6, 400}, {58, 13}, {6, 416}, {6, 448}, {6, 432}, {6, 464}, {6, 480}, {6, 496}, {6, 512}, {62, 12}, {5, 608}, {6, 576}, {68, 11}, {5, 640}, {5, 544}, {5, 704}, {70, 10}, {5, 672}, {5, 768}, {5, 736}, {5, 832}, {5, 864}, {5, 800}, {79, 9}, {5, 896}, {4, 928}, {5, 960}, {4, 1024}, {5, 992}, {88, 8}, {98, 7}, {111, 6}, {134, 5}, {167, 4}, {213, 3}, {314, 2}, {630, 1}},
{{7, 32}, {7, 29}, {8, 24}, {7, 30}, {9, 28}, {9, 26}, {8, 22}, {8, 27}, {7, 31}, {9, 25}, {6, 39}, {6, 37}, {9, 19}, {10, 21}, {6, 34}, {9, 23}, {6, 44}, {6, 38}, {6, 42}, {10, 20}, {6, 45}, {11, 17}, {6, 40}, {5, 50}, {7, 33}, {5, 47}, {6, 46}, {7, 43}, {6, 48}, {11, 18}, {5, 51}, {4, 62}, {6, 36}, {7, 35}, {5, 49}, {12, 16}, {4, 60}, {6, 54}, {5, 58}, {5, 63}, {12, 15}, {5, 55}, {4, 61}, {5, 59}, {8, 41}, {5, 65}, {3, 81}, {6, 57}, {13, 14}, {5, 64}, {6, 56}, {5, 53}, {6, 52}, {3, 97}, {3, 73}, {15, 12}, {16, 11}, {2, 105}, {3, 89}, {15, 13}, {2, 113}, {17, 10}, {19, 9}, {4, 121}, {2, 129}, {3, 137}, {2, 161}, {2, 145}, {2, 169}, {21, 8}, {2, 153}, {22, 7}, {2, 193}, {2, 185}, {2, 201}, {2, 177}, {2, 209}, {26, 6}, {2, 217}, {1, 256}, {28, 5}, {2, 225}, {1, 352}, {1, 241}, {2, 233}, {1, 304}, {35, 4}, {1, 249}, {1, 336}, {1, 384}, {1, 320}, {1, 272}, {1, 288}, {1, 432}, {1, 480}, {1, 368}, {1, 464}, {45, 3}, {1, 544}, {1, 512}, {1, 448}, {1, 400}, {1, 416}, {1, 576}, {1, 608}, {1, 496}, {2, 672}, {1, 704}, {64, 2}, {4, 800}, {1, 640}, {1, 736}, {2, 768}, {2, 832}, {3, 864}, {4, 928}, {4, 960}, {3, 1024}, {4, 992}, {4, 896}, {123, 1}},
{{4, 26}, {4, 25}, {5, 19}, {4, 27}, {5, 18}, {5, 23}, {4, 24}, {5, 20}, {5, 21}, {3, 30}, {6, 15}, {5, 22}, {4, 28}, {4, 29}, {3, 33}, {3, 37}, {3, 36}, {3, 35}, {6, 17}, {7, 16}, {6, 14}, {2, 58}, {3, 32}, {3, 34}, {3, 42}, {3, 39}, {7, 13}, {3, 40}, {3, 38}, {4, 31}, {3, 41}, {8, 12}, {3, 48}, {3, 47}, {3, 44}, {2, 52}, {8, 11}, {3, 49}, {8, 10}, {2, 50}, {2, 54}, {2, 51}, {3, 46}, {3, 45}, {3, 43}, {2, 55}, {2, 53}, {2, 56}, {2, 57}, {2, 62}, {2, 61}, {2, 64}, {2, 59}, {10, 9}, {2, 60}, {2, 73}, {2, 63}, {2, 81}, {11, 8}, {2, 65}, {12, 7}, {1, 89}, {13, 6}, {1, 97}, {14, 5}, {1, 113}, {2, 121}, {19, 4}, {1, 137}, {1, 105}, {1, 129}, {1, 153}, {1, 225}, {1, 209}, {24, 3}, {1, 161}, {1, 145}, {1, 185}, {1, 169}, {1, 193}, {2, 217}, {1, 177}, {1, 256}, {1, 272}, {1, 336}, {33, 2}, {1, 249}, {1, 241}, {1, 201}, {1, 320}, {1, 288}, {1, 352}, {1, 304}, {1, 368}, {1, 384}, {1, 233}, {2, 448}, {1, 496}, {1, 512}, {1, 480}, {1, 400}, {1, 432}, {1, 464}, {1, 416}, {1, 544}, {60, 1}, {1, 672}, {2, 768}, {1, 704}, {1, 576}, {1, 736}, {1, 640}, {1, 608}, {4, 832}, {3, 800}, {3, 864}, {4, 896}, {4, 960}, {2, 928}, {3, 1024}, {3, 992}},
{{1, 7}, {2, 9}, {1, 13}, {2, 6}, {1, 12}, {1, 10}, {2, 5}, {1, 15}, {2, 8}, {1, 11}, {1, 14}, {3, 4}, {1, 17}, {1, 16}, {1, 18}, {1, 22}, {1, 24}, {1, 19}, {1, 23}, {4, 3}, {1, 20}, {1, 21}, {1, 26}, {1, 25}, {5, 2}, {1, 29}, {1, 27}, {1, 28}, {1, 30}, {1, 32}, {1, 31}, {1, 35}, {1, 33}, {1, 40}, {1, 36}, {1, 34}, {1, 37}, {1, 38}, {1, 42}, {1, 41}, {1, 39}, {1, 49}, {1, 46}, {1, 43}, {1, 44}, {1, 51}, {1, 50}, {0, 52}, {1, 45}, {1, 48}, {0, 56}, {0, 57}, {1, 47}, {1, 53}, {1, 54}, {11, 1}, {1, 55}, {1, 59}, {1, 65}, {1, 60}, {1, 58}, {1, 61}, {1, 64}, {0, 62}, {1, 73}, {0, 63}, {1, 81}, {1, 89}, {1, 161}, {0, 105}, {1, 113}, {1, 145}, {1, 129}, {0, 97}, {1, 121}, {1, 153}, {1, 137}, {1, 185}, {1, 241}, {1, 177}, {1, 201}, {1, 225}, {1, 193}, {0, 169}, {1, 288}, {1, 209}, {1, 217}, {1, 304}, {1, 233}, {1, 400}, {1, 249}, {1, 368}, {1, 464}, {1, 336}, {1, 256}, {1, 272}, {1, 384}, {1, 352}, {1, 432}, {1, 496}, {1, 576}, {2, 512}, {1, 416}, {1, 320}, {1, 448}, {1, 480}, {1, 640}, {1, 544}, {1, 608}, {2, 704}, {2, 736}, {3, 768}, {1, 672}, {3, 800}, {4, 896}, {3, 992}, {3, 1024}, {2, 864}, {1, 832}, {3, 960}, {4, 928}},
{{1, 6}, {1, 7}, {1, 4}, {1, 10}, {1, 12}, {1, 5}, {1, 8}, {2, 3}, {1, 9}, {1, 13}, {1, 11}, {0, 16}, {2, 2}, {1, 14}, {1, 15}, {1, 17}, {1, 18}, {1, 19}, {0, 21}, {1, 20}, {1, 23}, {0, 22}, {0, 24}, {5, 1}, {1, 28}, {0, 27}, {0, 25}, {1, 26}, {0, 29}, {0, 30}, {0, 36}, {0, 33}, {0, 31}, {0, 32}, {1, 34}, {0, 38}, {1, 46}, {0, 42}, {1, 35}, {1, 37}, {0, 41}, {0, 40}, {0, 43}, {0, 39}, {0, 45}, {0, 44}, {0, 50}, {0, 47}, {0, 49}, {0, 54}, {0, 48}, {0, 56}, {1, 55}, {0, 59}, {0, 58}, {0, 51}, {1, 61}, {0, 53}, {1, 52}, {1, 81}, {0, 57}, {0, 60}, {0, 64}, {0, 62}, {0, 63}, {0, 65}, {0, 73}, {1, 105}, {0, 97}, {0, 89}, {1, 113}, {1, 129}, {1, 121}, {1, 153}, {1, 193}, {1, 145}, {1, 169}, {1, 137}, {1, 177}, {1, 161}, {1, 241}, {1, 217}, {1, 233}, {1, 249}, {1, 185}, {1, 209}, {1, 201}, {1, 225}, {1, 336}, {1, 272}, {1, 256}, {1, 304}, {1, 368}, {1, 448}, {1, 288}, {1, 384}, {1, 320}, {1, 544}, {1, 352}, {1, 432}, {1, 640}, {1, 496}, {1, 512}, {1, 464}, {1, 400}, {1, 416}, {1, 608}, {1, 672}, {1, 704}, {3, 800}, {3, 768}, {1, 736}, {1, 576}, {2, 928}, {1, 480}, {3, 832}, {4, 896}, {4, 864}, {3, 992}, {4, 1024}, {3, 960}},
{{1, 4}, {1, 5}, {1, 1}, {1, 3}, {1, 2}, {0, 9}, {0, 7}, {0, 6}, {0, 8}, {0, 10}, {0, 11}, {0, 12}, {0, 14}, {0, 13}, {0, 15}, {0, 16}, {0, 17}, {0, 18}, {0, 19}, {0, 22}, {0, 20}, {0, 21}, {0, 24}, {0, 25}, {0, 28}, {0, 29}, {0, 27}, {0, 23}, {0, 26}, {0, 32}, {0, 31}, {0, 30}, {0, 35}, {0, 34}, {0, 33}, {0, 37}, {0, 38}, {0, 41}, {0, 39}, {0, 40}, {0, 42}, {0, 36}, {0, 44}, {0, 43}, {0, 45}, {0, 48}, {0, 47}, {0, 46}, {0, 54}, {0, 49}, {0, 50}, {0, 51}, {0, 63}, {0, 52}, {0, 53}, {0, 57}, {0, 59}, {0, 55}, {0, 56}, {0, 58}, {0, 61}, {0, 60}, {0, 62}, {1, 64}, {0, 65}, {0, 81}, {0, 73}, {0, 89}, {0, 97}, {1, 129}, {0, 113}, {1, 105}, {1, 137}, {1, 121}, {1, 185}, {1, 161}, {1, 177}, {1, 145}, {0, 153}, {1, 201}, {1, 209}, {1, 193}, {1, 217}, {1, 241}, {1, 225}, {1, 169}, {1, 233}, {1, 272}, {1, 352}, {1, 256}, {1, 336}, {1, 288}, {1, 400}, {1, 368}, {1, 384}, {0, 249}, {1, 448}, {1, 480}, {1, 416}, {1, 432}, {1, 512}, {0, 320}, {1, 304}, {1, 464}, {1, 496}, {1, 608}, {1, 672}, {1, 576}, {1, 544}, {2, 640}, {1, 736}, {3, 800}, {2, 768}, {4, 896}, {1, 704}, {3, 832}, {3, 928}, {4, 960}, {1, 864}, {4, 1024}, {2, 992}}};
  
};

}}

#endif
